{% extends 'mainapp/base.html' %}

{% block style %}
    <style>
        .draft{
            height: 70vh;
            grid-gap: 0px;
            margin-top: 5px;
            margin-bottom: 5px;
            
        }
        .draft-row{
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            height: 8.75vh;
        }
        .draft-gap{
            border: 1px solid #ccc;
        }
        .host{
            background-color: #ccc;
        }
        
        div[player='pa']{
            background-color: rgb(46, 6, 83);
            height: 8.75vh;
            clip-path: circle();
            position: relative;
        }

        div[player='pb']{
            position: relative;
            background-color: burlywood;
            height: 8.75vh;
            clip-path: circle();
        }

        .hold{
            border: 2ps sold #ccc;
            clip-path: circle();
        }

        .hovered{
            border: cadetblue 2px dashed;
        }

        .invicible{
            display: none;
        }
        
    </style>
{% endblock style %}

{% block content %}
    <div class="container">
        <div class="controls mt-3">
            <button class="btn btn-outline-info" onclick="">Start</button>
        </div>
        <div class="draft">
            <div class="draft-row default" id="r_8">
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
            </div>
            <div class="draft-row default" id="r_7">
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
            </div>
            <div class="draft-row default" id="r_6">
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pb' draggable="true"></div></div>
            </div>
            <div class="draft-row" id="r_5">
                <div class="draft-gap host"></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"></div>
                <div class="draft-gap"></div>
            </div>
            <div class="draft-row" id="r_4">
                <div class="draft-gap"></div>
                <div class="draft-gap host"></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"></div>
            </div>
            <div class="draft-row default" id="r_3">
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
            </div>
            <div class="draft-row default" id="r_2">
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
            </div>
            <div class="draft-row default" id="r_1">
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
                <div class="draft-gap host"><div class="peke" player='pa' draggable="true"></div></div>
                <div class="draft-gap"></div>
            </div>
        </div>
    </div>
    
{% endblock content %}

{% block javascript %}
    <script>
        // const pekes = document.querySelectorAll('.peke')//get all the pekes

        // const getPlayer = (peke) => {
        //     return peke.getAttribute('player');
        // }

        // const getNextRow = (gap) => {
        //     // ......returns next_row
        //     row = gap.parentElement;//get the row in which the gap lies
        //     id = row.id;//get current row id
        //     i = id.split('_')[1];//split the id to get the number
                
        //     if(player == 'pa'){//if the player is Player A, incrament the row id and get the id of the next row
        //         nid = 'r_' + (parseInt(i)+1)
        //     }else if(player == 'pb'){//else if the player is Player B decreament the row id to get the id of the next row 
        //         nid = 'r_' + (parseInt(i)-1)
        //     }
        //     next_row = document.getElementById(nid)//now get the next row where the dragged peke can find new placements

        //     return next_row
        // }
        // const getPossibleGaps = (curent_gap, peke) => {
        //     ci = parseInt(get_child_index(curent_gap));// get the index of the current parent gap
        //     valid_gaps = new Array;//initiate an empty array for valid gaps
        //     if(ci > 0 && ci < 7){// if the gap is not the first pr last in the row then get two valid gaps
        //         pg1 = getNextRow(curent_gap).children[ci + 1];//the first gap
        //         pg2 = getNextRow(curent_gap).children[ci - 1];//the second gap
        //         // create an array and push this gaps then give then a class name//
        //         if(pg1.innerHTML == ''){//if the gap is empty then add the valid class name;
        //             valid_gaps.push(pg1);
        //         }else{}

        //         if(pg2.innerHTML == ''){//if the gap is empty then add the valid class name
        //             valid_gaps.push(pg2)
        //         }else{}
                
        //     }else if(ci == 0){//if the gap is the first in the row then return the gap to right in the next row
        //         pg = getNextRow(curent_gap).children[ci + 1]
        //         if(pg.innerHTML == ''){//also add the valid class if the gap is empty
        //             valid_gaps.push(pg);
        //         }else{}
        //     }else if(ci == 7){//if the gap is the last, then return the gap on the left in the next row
        //         pg = getNextRow(curent_gap).children[ci - 1]
        //         if(pg.innerHTML == ''){//similaly if the the gap is empty then add the valid class
        //             valid_gaps.push(pg);
        //         }else{}
        //     }

        //     for(gap of valid_gaps){
        //         if(gap.matches('valid')){

        //         }else{
        //             gap.classList.add('valid')
        //         }
        //     }

        //     const possibleMoves = document.querySelectorAll('.valid')
        //     for(const pgap of possibleMoves){
        //         pgap.addEventListener('dragover', dragOver);
        //         pgap.addEventListener('dragenter', dragEnter);
        //         pgap.addEventListener('dragleave', dragLeave);
        //         pgap.addEventListener('drop', () => {
        //             pgap.append(peke);
        //             pgap.classList.remove('hovered');
        //         });
        //     }
        // }
        
        // //loop through the pekes
        // for(const peke of pekes){
        //     const tar = peke
        //     const par = peke.parentElement; //get the current gap of the dragged peke
            
        //     tar.ondragstart = (e) => {//listen for the drag event on any peke
        //         tar.style.borderRadius = '50%'
        //         player = getPlayer(peke)//get the player who owns the dragged peke
        //         setTimeout(() => par.innerHTML = '', 0)// set gap empty after the peke has been dragged out
        //         //--------------------------------------------------------------------------------------------------------------//

        //         next_row = getNextRow(par);
        //         //-------------------------------------------------------------------------------------------------------------//

        //         // getPossibleGaps(curent_gap)............just prepare all the valid gaps to recieve the peke but should follow the protocol
        //         getPossibleGaps(par, tar);
        
        //         // console.log(getPossibleGaps(par))//console to test
        //     }

        //     tar.ondragend = (event) =>{//after the drag
                
        //     }
            
        // }

        // const removeClass = (className) =>{
        //     vgaps = document.querySelectorAll(className);
        //     console.log(vgaps.length)
        //     for(g of vgaps){
        //         g.classList.remove(className)
        //     }
        //     vgaps = document.querySelectorAll(className);
        //     if(vgaps.length > 0){
        //         removeClass(className)
        //     }else{
        //         console.log(vgaps.length)
        //     }
        // }

        // // this takes in a child node then finds its index in its parent node
        // function get_child_index(child) {
        //     cs = child.parentElement.children// get all the siblings to the child
        //     index = undefined//declare the index and set it to undefined
        //     for(c in cs){// loop through all the children until we find a child that is equal to the child
        //         tar = cs[c]
        //         if(tar == child){
        //             index = c;
        //             break;
        //         }
        //     }

        //     return index
        // }

        // function dragOver(e){
        //     e.preventDefault();    
        //     console.log('over')
        // }

        // function dragEnter(e){
        //     e.preventDefault();
        //     this.classList.add('hovered');
        // }

        // function dragLeave(){
        //     this.classList.remove('hovered');
        //     console.log('leave')
        // }

        // // function drop(){
        // //     peke = document.createElement('div')
        // //     peke.setAttribute('player', 'pa')          

        // //     this.append(peke)
            
        // //     console.log('drop')
        // // }
    </script>
{% endblock javascript %}